---
phase: 06-csv-import-wizard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
  - public/templates/colistiers-template.csv
autonomous: true

must_haves:
  truths:
    - "User sees CSV format explanation step in wizard"
    - "User can download a CSV template file"
    - "Wizard has 7 steps total (3 original + 4 new)"
  artifacts:
    - path: "index.html"
      provides: "4 new wizard steps HTML structure"
      contains: "wizard-step.*Format CSV"
    - path: "public/templates/colistiers-template.csv"
      provides: "Downloadable CSV template"
      min_lines: 3
  key_links:
    - from: "index.html"
      to: "public/templates/colistiers-template.csv"
      via: "download link href"
      pattern: 'href=.*colistiers-template\\.csv.*download'
---

<objective>
Add wizard HTML steps for CSV import flow and create downloadable CSV template.

Purpose: Extend the Phase 5 wizard with 4 new steps for CSV import (format explanation, upload, validation, confirmation). Create a template CSV file users can download.

Output: Updated index.html with 7 wizard steps, CSV template file in public/templates/.
</objective>

<execution_context>
@/Users/mmaudet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mmaudet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-csv-import-wizard/06-RESEARCH.md

@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add 4 CSV import steps to wizard HTML</name>
  <files>index.html</files>
  <action>
Add 4 new wizard-step divs inside the wizard-content div, AFTER the existing Step 3 (Preview/Confirmation). The new steps are:

Step 4: CSV Format Explanation (data-wz-title="Format CSV")
- h3: "Format du fichier CSV"
- Explanatory paragraph about required columns
- Unordered list with 3 items:
  - "nom" ou "name" (obligatoire)
  - "adresse" ou "address" (obligatoire)
  - "telephone" ou "phone" (optionnel)
- Download link: `<a href="/templates/colistiers-template.csv" download class="btn-secondary">Telecharger le modele</a>`

Step 5: File Upload (data-wz-title="Import")
- h3: "Importer vos colistiers"
- Drop zone div with id="csv-drop-zone" and class="drop-zone":
  - p: "Glissez votre fichier CSV ici"
  - p: "ou"
  - label with class="btn-primary" containing hidden file input:
    - Text: "Parcourir"
    - input type="file" id="wizard-csv-input" accept=".csv" hidden
- File info div: id="csv-file-info" hidden

Step 6: Validation Results (data-wz-title="Validation")
- h3: "Validation du fichier"
- Results div: id="validation-results"
  - Initial content: p with "Aucun fichier analyse" text

Step 7: Geocoding & Confirmation (data-wz-title="Confirmation")
- h3: "Generation de la carte"
- Progress div: id="geocoding-progress"
- Summary div: id="import-summary" hidden

Update wizard-js finish button label context: The last step is now Step 7 (Confirmation), which should trigger the completion flow.

Note: Keep the existing Step 3 (preview/confirmation of commune) but rename its data-wz-title from "Confirmation" to "Apercu" to distinguish it from the final confirmation step.
  </action>
  <verify>
Open index.html in browser, count wizard-step elements (should be 7). Verify each step has correct data-wz-title attribute. Check that download link points to /templates/colistiers-template.csv.
  </verify>
  <done>
index.html contains 7 wizard-step divs with correct structure: Welcome, Code postal, Apercu, Format CSV, Import, Validation, Confirmation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CSV template file</name>
  <files>public/templates/colistiers-template.csv</files>
  <action>
Create directory public/templates/ if it doesn't exist.

Create colistiers-template.csv with:
- Header row: nom,adresse,telephone
- 3 example data rows with realistic French data:
  - Jean Dupont,12 rue de la Paix 75001 Paris,0612345678
  - Marie Martin,45 avenue Victor Hugo 69003 Lyon,
  - Pierre Durand,8 boulevard Gambetta 33000 Bordeaux,0698765432

Use UTF-8 encoding. No BOM. Unix line endings (LF).

This template demonstrates:
- Required fields (nom, adresse) with values
- Optional field (telephone) - one row has it, one doesn't
- French address format with postal code and city
  </action>
  <verify>
File exists at public/templates/colistiers-template.csv. Contents have 4 lines (1 header + 3 data). Run `file public/templates/colistiers-template.csv` to verify encoding.
  </verify>
  <done>
CSV template file exists with correct header and 3 example rows demonstrating required and optional fields.
  </done>
</task>

</tasks>

<verification>
1. Open dev server: `npm run dev`
2. Clear localStorage to trigger wizard: `localStorage.clear()` in console, refresh
3. Verify wizard shows 7 steps in dots navigation
4. Navigate through all steps - each should display its content
5. On Format CSV step, verify download link is clickable
6. Download template, open in text editor, verify 4 lines with correct headers
</verification>

<success_criteria>
- index.html has 7 wizard-step elements with correct titles
- CSV template downloads from wizard
- Template has correct columns: nom, adresse, telephone
- All wizard steps are navigable (Next/Previous work)
</success_criteria>

<output>
After completion, create `.planning/phases/06-csv-import-wizard/06-01-SUMMARY.md`
</output>
