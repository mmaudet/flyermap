---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vite.config.js
  - index.html
  - src/main.js
  - src/style.css
  - src/map/config.js
  - src/data/commune.js
autonomous: true

must_haves:
  truths:
    - "User can see an interactive map centered on Chapet (78130) with zoom and pan controls"
    - "Chapet commune boundary displays as a visible polygon on the map"
    - "Street names are visible on the map tiles for orientation"
  artifacts:
    - path: "index.html"
      provides: "HTML entry point with map container"
      contains: "div id=\"map\""
    - path: "src/main.js"
      provides: "Leaflet map initialization"
      contains: "L.map"
    - path: "src/data/commune.js"
      provides: "Commune boundary fetching from geo.api.gouv.fr"
      contains: "geo.api.gouv.fr"
    - path: "src/style.css"
      provides: "Map container styling with explicit height"
      contains: "#map"
  key_links:
    - from: "src/main.js"
      to: "src/data/commune.js"
      via: "import and function call"
      pattern: "import.*commune"
    - from: "src/main.js"
      to: "src/map/config.js"
      via: "import for map center coordinates"
      pattern: "import.*config"
    - from: "index.html"
      to: "src/main.js"
      via: "script module"
      pattern: "type=\"module\".*main.js"
---

<objective>
Set up the complete Phase 1 Foundation: a Vite project with Leaflet displaying an interactive map of Chapet with commune boundary.

Purpose: Establish the map foundation for all subsequent features (team markers, zones, assignments). This phase validates the core tech stack works correctly together.

Output: A working development server showing Chapet map with visible commune boundary and street names.
</objective>

<execution_context>
@/Users/mmaudet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mmaudet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Vite project with Leaflet</name>
  <files>
    package.json
    vite.config.js
    index.html
    src/style.css
  </files>
  <action>
    1. Initialize Vite project with vanilla JavaScript template:
       ```bash
       npm create vite@latest . -- --template vanilla
       ```
       If prompted about existing directory, choose to continue/overwrite.

    2. Install Leaflet 1.9.4:
       ```bash
       npm install leaflet@1.9.4
       ```

    3. Update index.html to French locale with proper viewport:
       - Set lang="fr"
       - Title: "Carte Chapet - Vivons Chapet"
       - Single div with id="map"
       - Script module pointing to /src/main.js

    4. Create src/style.css with full-viewport map:
       ```css
       html, body {
         margin: 0;
         padding: 0;
         height: 100%;
       }

       #map {
         height: 100vh;
         width: 100%;
       }
       ```

    5. Delete any default Vite files not needed (counter.js, javascript.svg, etc.)
  </action>
  <verify>
    - `npm run dev` starts without errors
    - Browser shows empty page at localhost:5173 (no console errors)
    - package.json contains leaflet@1.9.4
  </verify>
  <done>
    Vite dev server runs, Leaflet installed, HTML/CSS structure ready for map.
  </done>
</task>

<task type="auto">
  <name>Task 2: Initialize Leaflet map with commune boundary</name>
  <files>
    src/main.js
    src/map/config.js
    src/data/commune.js
  </files>
  <action>
    1. Create src/map/config.js with Chapet coordinates:
       ```javascript
       // Chapet (78130) center coordinates
       // Format: [latitude, longitude] - Leaflet convention
       export const CHAPET_CENTER = [48.969, 1.932];
       export const DEFAULT_ZOOM = 14;
       export const MIN_ZOOM = 12;
       export const MAX_ZOOM = 19;

       // Chapet INSEE code for geo.api.gouv.fr
       export const CHAPET_INSEE = '78140';
       ```

    2. Create src/data/commune.js for boundary fetching:
       ```javascript
       import { CHAPET_INSEE } from '../map/config.js';

       /**
        * Fetch Chapet commune boundary from geo.api.gouv.fr
        * Returns GeoJSON with contour geometry (WGS84/EPSG:4326)
        */
       export async function fetchCommuneBoundary() {
         const url = `https://geo.api.gouv.fr/communes/${CHAPET_INSEE}?format=geojson&geometry=contour`;

         try {
           const response = await fetch(url);
           if (!response.ok) {
             throw new Error(`HTTP ${response.status}: ${response.statusText}`);
           }
           return await response.json();
         } catch (error) {
           console.error('Failed to load commune boundary:', error);
           throw error;
         }
       }
       ```

    3. Create src/main.js to initialize map and load boundary:
       ```javascript
       import L from 'leaflet';
       import 'leaflet/dist/leaflet.css';
       import './style.css';
       import { CHAPET_CENTER, DEFAULT_ZOOM, MIN_ZOOM, MAX_ZOOM } from './map/config.js';
       import { fetchCommuneBoundary } from './data/commune.js';

       // Initialize Leaflet map centered on Chapet
       const map = L.map('map', {
         center: CHAPET_CENTER,
         zoom: DEFAULT_ZOOM,
         minZoom: MIN_ZOOM,
         maxZoom: MAX_ZOOM
       });

       // Add OpenStreetMap tiles with proper attribution
       L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
         maxZoom: MAX_ZOOM,
         attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
       }).addTo(map);

       // Load and display commune boundary
       fetchCommuneBoundary()
         .then(geojson => {
           L.geoJSON(geojson, {
             style: {
               color: '#2563eb',      // Blue border
               weight: 3,
               fillColor: '#3b82f6',
               fillOpacity: 0.1
             }
           }).addTo(map);
         })
         .catch(error => {
           console.error('Could not display commune boundary:', error);
         });
       ```

    IMPORTANT - Avoid these pitfalls (from research):
    - Import leaflet/dist/leaflet.css BEFORE custom styles
    - Use [lat, lng] order for CHAPET_CENTER (Leaflet convention)
    - L.geoJSON() handles GeoJSON [lng, lat] conversion automatically
    - Include OSM attribution - this is mandatory
  </action>
  <verify>
    - `npm run dev` shows map at localhost:5173
    - Map is centered on Chapet with zoom controls visible
    - Blue commune boundary polygon is visible on the map
    - Street names are readable on the tiles
    - OpenStreetMap attribution visible in bottom-right corner
    - No console errors
  </verify>
  <done>
    Interactive map displays Chapet with visible commune boundary and street names. All three success criteria met.
  </done>
</task>

</tasks>

<verification>
Run the following checks:

1. **Dev server starts:**
   ```bash
   npm run dev
   ```
   Should start without errors on localhost:5173

2. **Visual verification (open in browser):**
   - Map centered on Chapet commune
   - Zoom in/out works (mouse wheel, buttons)
   - Pan/drag works
   - Blue boundary polygon visible around commune
   - Street names visible (Rue de la Mairie, etc.)
   - OpenStreetMap attribution in corner

3. **Console check:**
   - No JavaScript errors
   - No failed network requests

4. **Code structure:**
   ```bash
   ls src/
   ```
   Should show: main.js, style.css, map/, data/
</verification>

<success_criteria>
Phase 1 Foundation is complete when:

1. User can see an interactive map centered on Chapet (78130) with zoom and pan controls
2. Chapet commune boundary displays as a visible polygon on the map
3. Street names are visible on the map tiles for orientation

All three success criteria from ROADMAP.md must be verifiable by running the dev server.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md` using the summary template.

Include:
- What was built (Vite + Leaflet map with boundary)
- Key files created (src/main.js, src/map/config.js, src/data/commune.js)
- Decisions made (coordinate format, styling choices)
- Any issues encountered
</output>
